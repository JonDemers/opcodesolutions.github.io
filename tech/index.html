<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>OpCode Tech | Optimize Your Processes</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="https://opcodesolutions.com/tech/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="https://opcodesolutions.com/tech/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='https://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link href='https://fonts.gstatic.com' crossorigin rel='preconnect' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/opcodesolutions.com\/tech\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.0.3"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css%3Fver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-eclipse-css'  href='wp-content/plugins/crayon-syntax-highlighter/themes/eclipse/eclipse.css%3Fver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css%3Fver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='wp-includes/css/dist/block-library/style.min.css%3Fver=5.0.3.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-theme-css'  href='wp-includes/css/dist/block-library/theme.min.css%3Fver=5.0.3.css' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='wp-content/themes/twentytwelve/style.css%3Fver=5.0.3.css' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-block-style-css'  href='wp-content/themes/twentytwelve/css/blocks.css%3Fver=20181230.css' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='https://opcodesolutions.com/tech/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/opcodesolutions.com\/tech\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js%3Fver=_2.7.2_beta'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.0.3" />
	<style type="text/css" id="twentytwelve-header-css">
			.site-header h1 a,
		.site-header h2 {
			color: #8b0000;
		}
		</style>
	</head>

<body class="home blog wp-embed-responsive custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="../tech.html" title="OpCode Tech" rel="home">OpCode Tech</a></h1>
			<h2 class="site-description">Optimize Your Processes</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="../tech.html#content" title="Skip to content">Skip to content</a>
			<div class="menu-default-container"><ul id="menu-default" class="nav-menu"><li id="menu-item-19" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-19"><a href="../tech.html">Home</a></li>
<li id="menu-item-18" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-18"><a href="category/news/index.html">News</a></li>
<li id="menu-item-153" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-153"><a href="category/how-to/index.html">How To</a></li>
<li id="menu-item-17" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-17"><a href="category/development/index.html">Development</a></li>
<li id="menu-item-159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-159"><a href="contact/index.html">Contact</a></li>
</ul></div>		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">

	<div id="primary" class="site-content">
		<div id="content" role="main">
		
										
	<article id="post-189" class="post-189 post type-post status-publish format-standard hentry category-development category-how-to">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="how-to-migrate-3-mysql-databases-to-amazon-rds-in-5-minutes/index.html" rel="bookmark">How to Migrate 3 MySQL Databases to Amazon RDS in 5 Minutes</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I had a LAMT (Linux-Apache-MySQL-Tomcat) on <a href="http://aws.amazon.com/ec2/">Amazon EC2</a> and I wanted to move all remaining MySQL databases (3) to an existing <a href="http://aws.amazon.com/rds/">Amazon RDS</a> instance. This would allow me to shutdown the MySQL instance on EC2, freeing RAM for Tomcat and leveraging RDS automated backups for those 3 databases in case of a disaster. The databases to migrate only contain low volume TEST data, but I already have that RDS instance, so why not use it?</p>
<p>I also have a SLA with my clients that allows me to perform &#8220;<em>Standard daily maintenance</em>&#8220;. Basically, the &#8220;<em>Standard daily maintenance</em>&#8221; must be performed outside business hours and must last <strong>at most 15 minutes</strong>.</p>
<p>The key to the success of this migration was to <strong>prepare</strong>, <strong>prepare</strong> and <strong>prepare</strong> before the actual migration. So here is what I did before the migration:</p>
<ul>
<li>Create 3 empty databases and users on the RDS instance</li>
<li>Prepare new configuration files with the new JDBC url pointing to the RDS instance</li>
<li>Prepare all the commands that must be executed</li>
<li>Review and test the commands as needed</li>
</ul>
<p>Now that I am prepared I just need to wait for the &#8220;<em>Standard daily maintenance</em>&#8221; time. Then, I just copy and paste the commands in a terminal. I prefer to copy/paste the commands one by one, so if any command fails (for any reason), it can be fixed right away before running the next commands. Here is a summary of the commands:</p>
<ol>
<li>Shutdown Tomcat</li>
<li><a href="http://www.thegeekstuff.com/2008/09/backup-and-restore-mysql-database-using-mysqldump/">MySQL dump/restore</a> from EC2 to RDS (3 databases)</li>
<li>Copy the configuration files with JDBC url pointing to RDS (3 files)</li>
<li><a href="http://askubuntu.com/questions/40072/how-to-stop-apache2-mysql-from-starting-automatically-as-computer-starts">Prevent MySQL from starting during boot</a>: echo manual &gt; /etc/init/mysql.override</li>
<li>sudo reboot (I want to verify that MySQL on EC2 won&#8217;t start after a reboot)</li>
</ol>
<p>Everything went fine. After reboot, the MySQL instance on EC2 was not started, as expected. The Tomcat webapps were fine as well and there is more free RAM for Tomcat.</p>
<p>For those webapps, I have <a href="https://www.pingdom.com/">uptime monitoring at one minute interval with Pingdom</a>. I receive emails when a webapp go down and up again. Here is the &#8220;UP&#8221; email from Pingdom, showing <strong>5 minutes of downtime</strong> for that migration:</p>
<p style="padding-left: 30px;"><em>OpCode is UP again at 12/22/2014 08:25:36PM, after <strong>5m of downtime</strong>.</em></p>
<p>&nbsp;</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a>, <a href="category/how-to/index.html" rel="category tag">How To</a> on <a href="how-to-migrate-3-mysql-databases-to-amazon-rds-in-5-minutes/index.html" title="12:00 pm" rel="bookmark"><time class="entry-date" datetime="2014-12-23T12:00:10+00:00">December 23, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-160" class="post-160 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="imageio-read-causes-outofmemoryerror/index.html" rel="bookmark">ImageIO.read() causes OutOfMemoryError</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h2>The problem</h2>
<p>Few days ago, a reader contacted me with a problem he had in a piece of code. The code was creating thumbnails from images and was throwing an <strong>OutOfMemoryError</strong> after few dozens of images.  Here is the simplified code, line 26 throws OutOfMemoryError:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd1b2c826727932" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">ImageIO OutOfMemoryError</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

package com.opcodesolutions.demo;

import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.imageio.ImageIO;

public class Thumbnails {

	public static void main(String[] args) throws IOException {

		List&lt;Image&gt; thumbnails = new ArrayList&lt;&gt;();

		for (File file : new File("/path/to/images/").listFiles()) {

			if (!file.getName().endsWith(".jpg")) {
				// File is NOT a JPEG
				continue;
			}

			BufferedImage fullSizeImage = ImageIO.read(file); // OutOfMemoryError
			if (fullSizeImage == null) {
				// Could not parse JPEG, just ignore
				continue;
			}

			// Create thumbnail
			Image thumbnail = fullSizeImage
				.getScaledInstance(150, 150, Image.SCALE_DEFAULT);
			thumbnails.add(thumbnail);
		}

		// Do more stuff with thumbnails

	}

}
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-22">22</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-24">24</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-25">25</div><div class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-26">26</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-28">28</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-30">30</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-32">32</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-34">34</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-36">36</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-38">38</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-40">40</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b2c826727932-42">42</div><div class="crayon-num" data-line="crayon-5c44b1efd1b2c826727932-43">43</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-2"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">opcodesolutions</span><span class="crayon-sy">.</span><span class="crayon-v">demo</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">Image</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">BufferedImage</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">File</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">IOException</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">ArrayList</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">List</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-10">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-11"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-12">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-13"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Thumbnails</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-14">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-m">throws</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-16">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">List</span><span class="crayon-e ">&lt;Image&gt;</span><span class="crayon-h"> </span><span class="crayon-v">thumbnails</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ArrayList</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-18">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">File </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-s">"/path/to/images/"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">listFiles</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-20">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">endsWith</span><span class="crayon-sy">(</span><span class="crayon-s">".jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// File is NOT a JPEG</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-25">&nbsp;</div><div class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">BufferedImage </span><span class="crayon-v">fullSizeImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// OutOfMemoryError</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">fullSizeImage</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Could not parse JPEG, just ignore</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Create thumbnail</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Image </span><span class="crayon-v">thumbnail</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">fullSizeImage</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">getScaledInstance</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-v">SCALE_DEFAULT</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thumbnails</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">thumbnail</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Do more stuff with thumbnails</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b2c826727932-42"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b2c826727932-43">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>And here is the stacktrace with the OutOfMemoryError:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd1b34889021455" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">OutOfMemoryError Stacktrace</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

Exception in thread "main" java.lang.OutOfMemoryError: Java heap space
	at java.awt.image.DataBufferByte.&lt;init&gt;(DataBufferByte.java:92)
	at java.awt.image.ComponentSampleModel.createDataBuffer(ComponentSampleModel.java:415)
	at java.awt.image.Raster.createWritableRaster(Raster.java:941)
	at javax.imageio.ImageTypeSpecifier.createBufferedImage(ImageTypeSpecifier.java:1073)
	at javax.imageio.ImageReader.getDestination(ImageReader.java:2896)
	at com.sun.imageio.plugins.jpeg.JPEGImageReader.readInternal(JPEGImageReader.java:1066)
	at com.sun.imageio.plugins.jpeg.JPEGImageReader.read(JPEGImageReader.java:1034)
	at javax.imageio.ImageIO.read(ImageIO.java:1448)
	at javax.imageio.ImageIO.read(ImageIO.java:1308)
	at com.opcodesolutions.demo.Thumbnails.main(Thumbnails.java:26)
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-11">11</div><div class="crayon-num crayon-marked-num crayon-top crayon-bottom crayon-striped-num" data-line="crayon-5c44b1efd1b34889021455-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd1b34889021455-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b34889021455-2"><span class="crayon-e">Exception </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-i">thread</span><span class="crayon-h"> </span><span class="crayon-s">"main"</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">lang</span><span class="crayon-sy">.</span><span class="crayon-v">OutOfMemoryError</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Java </span><span class="crayon-e">heap </span><span class="crayon-e">space</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-3"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">DataBufferByte</span><span class="crayon-sy">.</span><span class="crayon-o">&lt;</span><span class="crayon-v">init</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-v">DataBufferByte</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">92</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b34889021455-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">ComponentSampleModel</span><span class="crayon-sy">.</span><span class="crayon-e">createDataBuffer</span><span class="crayon-sy">(</span><span class="crayon-v">ComponentSampleModel</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">415</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">Raster</span><span class="crayon-sy">.</span><span class="crayon-e">createWritableRaster</span><span class="crayon-sy">(</span><span class="crayon-v">Raster</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">941</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b34889021455-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageTypeSpecifier</span><span class="crayon-sy">.</span><span class="crayon-e">createBufferedImage</span><span class="crayon-sy">(</span><span class="crayon-v">ImageTypeSpecifier</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">1073</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageReader</span><span class="crayon-sy">.</span><span class="crayon-e">getDestination</span><span class="crayon-sy">(</span><span class="crayon-v">ImageReader</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">2896</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b34889021455-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">sun</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">plugins</span><span class="crayon-sy">.</span><span class="crayon-v">jpeg</span><span class="crayon-sy">.</span><span class="crayon-v">JPEGImageReader</span><span class="crayon-sy">.</span><span class="crayon-e">readInternal</span><span class="crayon-sy">(</span><span class="crayon-v">JPEGImageReader</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">1066</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">sun</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">plugins</span><span class="crayon-sy">.</span><span class="crayon-v">jpeg</span><span class="crayon-sy">.</span><span class="crayon-v">JPEGImageReader</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">JPEGImageReader</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">1034</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b34889021455-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">1448</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">1308</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-bottom crayon-striped-line" id="crayon-5c44b1efd1b34889021455-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">at </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">opcodesolutions</span><span class="crayon-sy">.</span><span class="crayon-v">demo</span><span class="crayon-sy">.</span><span class="crayon-v">Thumbnails</span><span class="crayon-sy">.</span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-v">Thumbnails</span><span class="crayon-sy">.</span><span class="crayon-v">java</span><span class="crayon-o">:</span><span class="crayon-cn">26</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c44b1efd1b34889021455-13">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p></p>
<h2>The cause of the OutOfMemoryError</h2>
<p>The cause of that problem is not obvious. The stacktrace (and the title of this article) is somewhat misleading. Here is what happens: The call to <strong>fullSizeImage.getScaledInstance()</strong> (lines 33-34) produces a smaller image <em>thumbnail</em>, but that thumbnail object<strong> keeps a reference</strong> to the <em>fullSizeImage</em>. Since JPEG files are highly compressed, reading and parsing them takes a significant amount of memory and that memory can never be freed.</p>
<h2>The solution: Do not use Image.getScaledInstance()</h2>
<p>The solution was to replace the call to <strong>fullSizeImage.getScaledInstance()</strong> with the lines 34-38 highlighted below. That solution allowed the code to read thousands of images, because the <em>fullSizeImage</em> was no longer kept in memory.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd1b39580013365" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Resize an image</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

package com.opcodesolutions.demo;

import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.imageio.ImageIO;

public class Thumbnails {

	public static void main(String[] args) throws IOException {

		List&lt;Image&gt; thumbnails = new ArrayList&lt;&gt;();

		for (File file : new File("/path/to/images/").listFiles()) {

			if (!file.getName().endsWith(".jpg")) {
				// File is NOT a JPEG
				continue;
			}

			BufferedImage fullSizeImage = ImageIO.read(file);
			if (fullSizeImage == null) {
				// Could not parse JPEG, just ignore
				continue;
			}

			// Create thumbnail
			BufferedImage thumbnail = new BufferedImage(150, 150,
				BufferedImage.TYPE_INT_ARGB);
			Graphics2D g = thumbnail.createGraphics();
			g.drawImage(fullSizeImage, 0, 0, 150, 150, null);
			g.dispose();
			thumbnails.add(thumbnail);
		}

		// Do more stuff with thumbnails

	}

}
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-22">22</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-24">24</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-26">26</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-28">28</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-30">30</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-32">32</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-33">33</div><div class="crayon-num crayon-marked-num crayon-top crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-34">34</div><div class="crayon-num crayon-marked-num" data-line="crayon-5c44b1efd1b39580013365-35">35</div><div class="crayon-num crayon-marked-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-36">36</div><div class="crayon-num crayon-marked-num" data-line="crayon-5c44b1efd1b39580013365-37">37</div><div class="crayon-num crayon-marked-num crayon-bottom crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-38">38</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-40">40</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-42">42</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-44">44</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd1b39580013365-46">46</div><div class="crayon-num" data-line="crayon-5c44b1efd1b39580013365-47">47</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-2"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">opcodesolutions</span><span class="crayon-sy">.</span><span class="crayon-v">demo</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">Graphics2D</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">Image</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">BufferedImage</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">File</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">IOException</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">ArrayList</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-10"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">List</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-12"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-14"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Thumbnails</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-m">throws</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">List</span><span class="crayon-e ">&lt;Image&gt;</span><span class="crayon-h"> </span><span class="crayon-v">thumbnails</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">ArrayList</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">File </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-s">"/path/to/images/"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">listFiles</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">endsWith</span><span class="crayon-sy">(</span><span class="crayon-s">".jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// File is NOT a JPEG</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-26">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">BufferedImage </span><span class="crayon-v">fullSizeImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">fullSizeImage</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Could not parse JPEG, just ignore</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">continue</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-32">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Create thumbnail</span></div><div class="crayon-line crayon-marked-line crayon-top crayon-striped-line" id="crayon-5c44b1efd1b39580013365-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">BufferedImage </span><span class="crayon-v">thumbnail</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">BufferedImage</span><span class="crayon-sy">(</span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-marked-line" id="crayon-5c44b1efd1b39580013365-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">BufferedImage</span><span class="crayon-sy">.</span><span class="crayon-v">TYPE_INT_ARGB</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Graphics2D</span><span class="crayon-h"> </span><span class="crayon-v">g</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">thumbnail</span><span class="crayon-sy">.</span><span class="crayon-e">createGraphics</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line" id="crayon-5c44b1efd1b39580013365-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-sy">.</span><span class="crayon-e">drawImage</span><span class="crayon-sy">(</span><span class="crayon-v">fullSizeImage</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-marked-line crayon-bottom crayon-striped-line" id="crayon-5c44b1efd1b39580013365-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">g</span><span class="crayon-sy">.</span><span class="crayon-e">dispose</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thumbnails</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">thumbnail</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Do more stuff with thumbnails</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd1b39580013365-46"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd1b39580013365-47">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p></p>
<h2>References</h2>
<p>From Oracle&#8217;s website: <a title="How do I create a resized copy of an image?" href="http://www.oracle.com/technetwork/java/index-137037.html#Q_How_do_I_create_a_resized_copy" target="_blank" rel="noopener">How do I create a resized copy of an image?</a></p>
<p>For this particular problem, I did not need to produce a heap dump, because the code was small enough. With a few tests and a few searches on Google, I could figure-out what was happening. However, if you have no idea where the OutOfMemoryError comes from, you may want to read this article: <a title="java.lang.OutOfMemoryError: Java heap space" href="solve-java-lang-outofmemoryerror-java-heap-space/index.html">How to fix java.lang.OutOfMemoryError: Java heap space</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="imageio-read-causes-outofmemoryerror/index.html" title="4:35 pm" rel="bookmark"><time class="entry-date" datetime="2014-11-24T16:35:50+00:00">November 24, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-122" class="post-122 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="https-wildcard-subdomain-dns-apache-tomcat-config/index.html" rel="bookmark">HTTPS Wildcard Subdomain: DNS + Apache + Tomcat Config</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I recently had to configure HTTPS on a wildcard subdomain with Apache HTTP server as reverse proxy to a Tomcat backend. I had few more requirements:</p>
<ol>
<li>Redirect all <strong>http</strong> traffic to <strong>http<span style="text-decoration: underline;">s</span></strong> and preserve the subdomain (hostname). For instance:
<ul>
<li>http://<strong>sub<span style="text-decoration: underline;">1</span></strong>.example.com/ -&gt; redirect to -&gt; http<strong><span style="text-decoration: underline;">s</span></strong>://<strong>sub<span style="text-decoration: underline;">1</span></strong>.example.com/</li>
<li>http://<strong>sub<span style="text-decoration: underline;">2</span></strong>.example.com/ -&gt; redirect to -&gt; http<span style="text-decoration: underline;"><strong>s</strong></span>://<strong>sub<span style="text-decoration: underline;">2</span></strong>.example.com/</li>
<li>etc.</li>
</ul>
</li>
<li>I want to have a <strong>PHP</strong> wiki on the subdirectory <strong>/wiki</strong> and I want to send the rest of the traffic to Tomcat.</li>
<li><strong>Tomcat</strong> needs to know the subdomain (hostname) and will serve content accordingly.</li>
<li>I don&#8217;t know the subdomains in advance because they are <strong>chosen by users</strong>, just like *.wordpress.com</li>
</ol>
<p>Few parts were not trivial, so I will share my setup.</p>
<h2>DNS Wildcard Subdomain Configuration</h2>
<p>DNS is probably the easiest part. Nowadays, most domain registrar offer good DNS support for free with your domain. If that is not the case of your registrar, you may want to consider namecheap. Their <a title="Namecheap Wildcard Subdomain" href="https://www.namecheap.com/support/knowledgebase/article.aspx/597/10/how-can-i-set-up-a-catchall-wildcard-subdomain" target="_blank">DNS also support wildcard entries</a>. Otherwise, you can use the popular <strong>Bind DNS server</strong>. Here is how to configure a wildcard entry in BIND. Change <em>55.55.55.55</em> with your IP address.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd2387550534246" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">BIND Wildcard Subdomain</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

*	IN	A	55.55.55.55
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd2387550534246-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2387550534246-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd2387550534246-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd2387550534246-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2387550534246-2"><span class="crayon-o">*</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">IN</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">A</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">55.55.55.55</span></div><div class="crayon-line" id="crayon-5c44b1efd2387550534246-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<h2>Apache Wildcard Subdomain Configuration</h2>
<p>This was trickier. The Apache HTTP server configuration has 2 main parts.</p>
<p><strong>1. HTTP (port 80)</strong>: We use mod_rewrite to redirect all traffic for *.example.com to https (port 443) and we preserve the hostname with the %{HTTP_HOST} variable.</p>
<p><strong>2. HTTPS (port 443)</strong>: Except for the PHP subdirectory (/wiki), we reverse proxy all traffic to Tomcat, which listen on port 9090 of localhost.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd238e607105814" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Apache HTTPS Wildcard Subdomain</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Apache</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

# Allow non-SNI clients
SSLStrictSNIVHostCheck off

# HTTP configuration
&lt;VirtualHost *:80&gt;

	ServerName example.com

	# Wildcard subdomain
	ServerAlias *.example.com

	ServerAdmin info@example.com

	# Permanent redirect (301) to HTTPS and preserve
	# hostname (but do not preserve path)
	RewriteEngine On
	RewriteRule .* https://%{HTTP_HOST}/? [R=301,L]
&lt;/VirtualHost&gt;

# HTTPS configuration
&lt;VirtualHost *:443&gt;

	ServerName example.com

	# Wildcard subdomain
	ServerAlias *.example.com

	ServerAdmin info@example.com
	
	# PHP Wiki on path /wiki 
	Alias /wiki /opt/example.com/php/wiki
	&lt;Directory /opt/example.com/php/wiki&gt;
		AllowOverride All
		Require all granted
	&lt;/Directory&gt;

	# Reverse proxy everything to Tomcat except for /wiki
	ProxyRequests Off
	ProxyPass /wiki !
	ProxyPass / http://localhost:9090/
	ProxyPassReverse / http://localhost:9090/
	
	# Logs
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# Wildcard SSL/TLS Certificate files
	SSLEngine on
	SSLCertificateFile /etc/ssl/certs/STAR_example_com.crt
	SSLCertificateKeyFile /etc/ssl/private/example.key
	SSLCertificateChainFile /etc/ssl/certs/example.ca-bundle

	# Standard script config
	&lt;FilesMatch "\.(cgi|shtml|phtml|php)$"&gt;
		SSLOptions +StdEnvVars
	&lt;/FilesMatch&gt;
	&lt;Directory /usr/lib/cgi-bin&gt;
		SSLOptions +StdEnvVars
	&lt;/Directory&gt;
	
	# Standard config for Internet Explorer
	BrowserMatch "MSIE [2-6]" \
		nokeepalive ssl-unclean-shutdown \
		downgrade-1.0 force-response-1.0
	
	BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
	
&lt;/VirtualHost&gt;
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-22">22</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-24">24</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-26">26</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-28">28</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-30">30</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-32">32</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-34">34</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-36">36</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-38">38</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-40">40</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-42">42</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-44">44</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-46">46</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-48">48</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-50">50</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-52">52</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-54">54</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-56">56</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-58">58</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-60">60</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-62">62</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-64">64</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-66">66</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-68">68</div><div class="crayon-num" data-line="crayon-5c44b1efd238e607105814-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd238e607105814-70">70</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd238e607105814-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-2"><span class="crayon-c"># Allow non-SNI clients</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-3"><span class="crayon-r">SSLStrictSNIVHostCheck</span><span class="crayon-h"> </span><span class="crayon-i ">off</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-4">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-5"><span class="crayon-c"># HTTP configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-6"><span class="crayon-r ">&lt;</span><span class="crayon-r ">VirtualHost</span><span class="crayon-h"> </span><span class="crayon-e ">*:80</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-8"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerName</span><span class="crayon-h"> </span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Wildcard subdomain</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-11"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerAlias</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-12">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-13"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerAdmin</span><span class="crayon-h"> </span><span class="crayon-i ">info</span><span class="crayon-sy">@</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-14">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Permanent redirect (301) to HTTPS and preserve</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># hostname (but do not preserve path)</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-17"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;RewriteEngine</span><span class="crayon-h"> </span><span class="crayon-i ">On</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-18"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;RewriteRule</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-i ">https</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-v ">%{HTTP_HOST}</span><span class="crayon-o">/</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-cn ">[R=301,L]</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-19"><span class="crayon-r ">&lt;</span><span class="crayon-r ">/VirtualHost</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-20">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-21"><span class="crayon-c"># HTTPS configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-22"><span class="crayon-r ">&lt;</span><span class="crayon-r ">VirtualHost</span><span class="crayon-h"> </span><span class="crayon-e ">*:443</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-24"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerName</span><span class="crayon-h"> </span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Wildcard subdomain</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-27"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerAlias</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-28">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-29"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerAdmin</span><span class="crayon-h"> </span><span class="crayon-i ">info</span><span class="crayon-sy">@</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># PHP Wiki on path /wiki </span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-32"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;Alias</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">wiki</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">opt</span><span class="crayon-o">/</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span><span class="crayon-o">/</span><span class="crayon-i ">php</span><span class="crayon-o">/</span><span class="crayon-i ">wiki</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">Directory</span><span class="crayon-h"> </span><span class="crayon-e ">/opt/example.com/php/wiki</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-34"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AllowOverride</span><span class="crayon-h"> </span><span class="crayon-i ">All</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-35"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Require</span><span class="crayon-h"> </span><span class="crayon-i ">all</span><span class="crayon-h"> </span><span class="crayon-i ">granted</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">/Directory</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Reverse proxy everything to Tomcat except for /wiki</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-39"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ProxyRequests</span><span class="crayon-h"> </span><span class="crayon-i ">Off</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-40"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ProxyPass</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">wiki</span><span class="crayon-h"> </span><span class="crayon-o">!</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-41"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ProxyPass</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i ">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-i ">localhost</span><span class="crayon-o">:</span><span class="crayon-cn">9090</span><span class="crayon-o">/</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-42"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ProxyPassReverse</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i ">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-i ">localhost</span><span class="crayon-o">:</span><span class="crayon-cn">9090</span><span class="crayon-o">/</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Logs</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-45"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ErrorLog</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">{</span><span class="crayon-i ">APACHE_LOG_DIR</span><span class="crayon-sy">}</span><span class="crayon-o">/</span><span class="crayon-i ">error</span><span class="crayon-sy">.</span><span class="crayon-i ">log</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-46"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;CustomLog</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">{</span><span class="crayon-i ">APACHE_LOG_DIR</span><span class="crayon-sy">}</span><span class="crayon-o">/</span><span class="crayon-i ">access</span><span class="crayon-sy">.</span><span class="crayon-i ">log</span><span class="crayon-h"> </span><span class="crayon-i ">combined</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Wildcard SSL/TLS Certificate files</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-49"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;SSLEngine</span><span class="crayon-h"> </span><span class="crayon-i ">on</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-50"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;SSLCertificateFile</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">etc</span><span class="crayon-o">/</span><span class="crayon-i ">ssl</span><span class="crayon-o">/</span><span class="crayon-i ">certs</span><span class="crayon-o">/</span><span class="crayon-i ">STAR_example_com</span><span class="crayon-sy">.</span><span class="crayon-i ">crt</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-51"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;SSLCertificateKeyFile</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">etc</span><span class="crayon-o">/</span><span class="crayon-i ">ssl</span><span class="crayon-o">/</span><span class="crayon-i ">private</span><span class="crayon-o">/</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">key</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-52"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;SSLCertificateChainFile</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">etc</span><span class="crayon-o">/</span><span class="crayon-i ">ssl</span><span class="crayon-o">/</span><span class="crayon-i ">certs</span><span class="crayon-o">/</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">ca-bundle</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Standard script config</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">FilesMatch</span><span class="crayon-h"> </span><span class="crayon-s">"\.(cgi|shtml|phtml|php)$"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-56"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSLOptions</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-i ">StdEnvVars</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">/FilesMatch</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">Directory</span><span class="crayon-h"> </span><span class="crayon-e ">/usr/lib/cgi-bin</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-59"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSLOptions</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-i ">StdEnvVars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">/Directory</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Standard config for Internet Explorer</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-63"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;BrowserMatch</span><span class="crayon-h"> </span><span class="crayon-s">"MSIE [2-6]"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-64"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nokeepalive</span><span class="crayon-h"> </span><span class="crayon-i ">ssl-unclean-shutdown</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-65"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downgrade</span><span class="crayon-v ">-1</span><span class="crayon-sy">.</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i ">force-response-1</span><span class="crayon-sy">.</span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-66"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-67"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;BrowserMatch</span><span class="crayon-h"> </span><span class="crayon-s">"MSIE [17-9]"</span><span class="crayon-h"> </span><span class="crayon-i ">ssl-unclean-shutdown</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5c44b1efd238e607105814-69"><span class="crayon-r ">&lt;</span><span class="crayon-r ">/VirtualHost</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd238e607105814-70">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0097 seconds] -->
<p></p>
<h2>Tomcat Wildcard Subdomain Configuration</h2>
<p>Below you&#8217;ll find the configuration of Tomcat (in server.xml), which is quite standard. Actually, we do not need to define any &#8220;<em>wildcard</em>&#8220;, we just define a <strong>defaultHost</strong> in the <strong>Engine</strong> element. Then we deploy a <strong>ROOT.war</strong> in the webapps directory (<em>/opt/example.com/tomcat7/webapps</em>) to serve all content at the root context path.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd2393224436789" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Tomcat Wildcard Subdomain</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">XHTML</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

&lt;Service name="example"&gt;

	&lt;Connector port="9090" protocol="HTTP/1.1" connectionTimeout="20000"
			URIEncoding="UTF-8" /&gt;

	&lt;Engine name="example" defaultHost="localhost"&gt;

		&lt;Host name="localhost" appBase="/opt/example.com/tomcat7/webapps"
				unpackWARs="true" autoDeploy="true"&gt;

			&lt;Valve className="org.apache.catalina.valves.AccessLogValve"
					directory="logs" prefix="example.com_access_log."
					suffix=".txt" pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b" /&gt;

		&lt;/Host&gt;

	&lt;/Engine&gt;

&lt;/Service&gt;
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2393224436789-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd2393224436789-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd2393224436789-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-2"><span class="crayon-r ">&lt;Service </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"example"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-4"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;Connector </span><span class="crayon-e ">port</span><span class="crayon-o">=</span><span class="crayon-s ">"9090"</span><span class="crayon-h"> </span><span class="crayon-e ">protocol</span><span class="crayon-o">=</span><span class="crayon-s ">"HTTP/1.1"</span><span class="crayon-h"> </span><span class="crayon-e ">connectionTimeout</span><span class="crayon-o">=</span><span class="crayon-s ">"20000"</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e ">URIEncoding</span><span class="crayon-o">=</span><span class="crayon-s ">"UTF-8"</span><span class="crayon-r "> /&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-6">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-7"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;Engine </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"example"</span><span class="crayon-h"> </span><span class="crayon-e ">defaultHost</span><span class="crayon-o">=</span><span class="crayon-s ">"localhost"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-8">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-9"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;Host </span><span class="crayon-e ">name</span><span class="crayon-o">=</span><span class="crayon-s ">"localhost"</span><span class="crayon-h"> </span><span class="crayon-e ">appBase</span><span class="crayon-o">=</span><span class="crayon-s ">"/opt/example.com/tomcat7/webapps"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e ">unpackWARs</span><span class="crayon-o">=</span><span class="crayon-s ">"true"</span><span class="crayon-h"> </span><span class="crayon-e ">autoDeploy</span><span class="crayon-o">=</span><span class="crayon-s ">"true"</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-12"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;Valve </span><span class="crayon-e ">className</span><span class="crayon-o">=</span><span class="crayon-s ">"org.apache.catalina.valves.AccessLogValve"</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e ">directory</span><span class="crayon-o">=</span><span class="crayon-s ">"logs"</span><span class="crayon-h"> </span><span class="crayon-e ">prefix</span><span class="crayon-o">=</span><span class="crayon-s ">"example.com_access_log."</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e ">suffix</span><span class="crayon-o">=</span><span class="crayon-s ">".txt"</span><span class="crayon-h"> </span><span class="crayon-e ">pattern</span><span class="crayon-o">=</span><span class="crayon-s ">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span><span class="crayon-r "> /&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-16"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;/Host&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-18"><span class="crayon-i ">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;/Engine&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2393224436789-20"><span class="crayon-r ">&lt;/Service&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd2393224436789-21">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<h2>How does Tomcat Know the Subdomain?</h2>
<p>With this configuration, all content will be sent to Tomcat with &#8220;<em>localhost</em>&#8221; as the hostname. Fortunately, the <a title="Reverse Proxy Request Headers" href="http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#x-headers" target="_blank">Apache reverse proxy will send extra request headers</a> to Tomcat, namely:</p>
<blockquote><p>X-Forwarded-For: The IP address of the client.</p>
<p><strong>X-Forwarded-Host: The original host requested by the client in the Host HTTP request header.</strong></p>
<p>X-Forwarded-Server: The hostname of the proxy server.</p></blockquote>
<p>So in Tomcat (or any other servlet container), just use the Java code below to get the value of that header &#8220;<strong>X-Forwarded-Host</strong>&#8221; and you&#8217;ll know the subdomain.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd2396311850741" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Tomcat code to get subdomain</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

String subdomain = request.getHeader("X-Forwarded-Host");
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd2396311850741-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2396311850741-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd2396311850741-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd2396311850741-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2396311850741-2"><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">subdomain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-e">getHeader</span><span class="crayon-sy">(</span><span class="crayon-s">"X-Forwarded-Host"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2396311850741-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>&nbsp;</p>
<p>Alternatively, you may also use the <a title="ProxyPreserveHost Directive" href="http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypreservehost" target="_blank">ProxyPreserveHost On</a> directive in Apache configuration and you should be able to get the hostname (subdomain) normally in Tomcat. <em>NOTE: I haven&#8217;t tested that setup.</em></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd2399244657494" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Tomcat code to get requested hostname</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

String subdomain = request.getServerName();
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd2399244657494-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2399244657494-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd2399244657494-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd2399244657494-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2399244657494-2"><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">subdomain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-e">getServerName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2399244657494-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h2>Bonus: Wildcard SSL Certificate</h2>
<p>Of course you&#8217;ll need a wildcard SSL certificate. Those are usually very expensive, but <a title="Namecheap Wildcard Certificates" href="https://www.namecheap.com/security/ssl-certificates/comodo/positivessl-wildcard.aspx" target="_blank">Namecheap resells Comodo wildcard certificate at very good price</a>. No, I do not have any interest in namecheap, they just happen to be very good at what they do 🙂</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="https-wildcard-subdomain-dns-apache-tomcat-config/index.html" title="1:45 pm" rel="bookmark"><time class="entry-date" datetime="2014-11-19T13:45:31+00:00">November 19, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-81" class="post-81 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="ubuntu-apache-reverse-proxy-rewrite-html-links/index.html" rel="bookmark">Ubuntu Apache Reverse Proxy Rewrite HTML Links</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I just wasted few hours on this, so I will share a few tips. If you want to setup a reverse proxy and <strong>rewrite links in html</strong> pages, you can use Apache module <a title="Apache Module mod_proxy_html" href="http://httpd.apache.org/docs/current/mod/mod_proxy_html.html"><strong>mod_proxy_html</strong></a>.</p>
<h2>Step 1. Install and enable Apache mod_proxy</h2>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd28e8875411968" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Ubuntu enable apache mod_proxy</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ sudo apt-get install libapache2-mod-proxy-html libxml2-dev
$ sudo a2enmod proxy
$ sudo a2enmod proxy_http
$ sudo a2enmod proxy_html
$ sudo a2enmod xml2enc
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd28e8875411968-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28e8875411968-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd28e8875411968-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28e8875411968-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd28e8875411968-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28e8875411968-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd28e8875411968-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd28e8875411968-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28e8875411968-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-v">apt</span><span class="crayon-o">-</span><span class="crayon-r">get</span><span class="crayon-h"> </span><span class="crayon-e">install </span><span class="crayon-v">libapache2</span><span class="crayon-o">-</span><span class="crayon-v">mod</span><span class="crayon-o">-</span><span class="crayon-v">proxy</span><span class="crayon-o">-</span><span class="crayon-e">html </span><span class="crayon-v">libxml2</span><span class="crayon-o">-</span><span class="crayon-i">dev</span></div><div class="crayon-line" id="crayon-5c44b1efd28e8875411968-3"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">a2enmod </span><span class="crayon-i">proxy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28e8875411968-4"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">a2enmod </span><span class="crayon-v">proxy</span><span class="crayon-sy">_</span>http</div><div class="crayon-line" id="crayon-5c44b1efd28e8875411968-5"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">a2enmod </span><span class="crayon-v">proxy</span><span class="crayon-sy">_</span>html</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28e8875411968-6"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">a2enmod </span><span class="crayon-i">xml2enc</span></div><div class="crayon-line" id="crayon-5c44b1efd28e8875411968-7">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>&nbsp;</p>
<h2>Step 2. Apache configuration</h2>
<p>In <strong>Ubuntu 14.04 LTS</strong>, it does not work &#8220;out of the box&#8221;, because some standard config is missing when enabling mod_proxy_html. More specifically, the <a title="ProxyHTMLLinks Directive" href="http://httpd.apache.org/docs/current/mod/mod_proxy_html.html#proxyhtmllinks"><strong>ProxyHTMLLinks</strong></a> directives are missing in Ubuntu 14.04. I say &#8220;missing&#8221;, because those directives are included by default in earlier releases and in other distros (in a file called proxy_html.conf). Also, pay particular attention to the directives <a title="ProxyHTMLEnable Directive" href="http://httpd.apache.org/docs/current/mod/mod_proxy_html.html#proxyhtmlenable"><strong>ProxyHTMLEnable</strong></a>, <a title="ProxyHTMLExtended Directive" href="http://httpd.apache.org/docs/current/mod/mod_proxy_html.html#proxyhtmlextended"><strong>ProxyHTMLExtended</strong></a> and <a title="SetOutputFilter Directive" href="http://httpd.apache.org/docs/current/mod/core.html#setoutputfilter"><strong>SetOutputFilter</strong></a>.</p>
<p>So, let&#8217;s say you want to have your apache server at <em>http://host1.example.com/path1</em> to serve (proxy) the content of the server at <em>http://host2.example.com/path2</em> and <strong>rewrite HTML links</strong>. Here is the config that works for me on Ubuntu 14.04 LTS.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd28ef059968487" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">host1.example.com.conf</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Apache</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

&lt;VirtualHost *:80&gt;
	ServerName host1.example.com
	ProxyRequests Off
	&lt;Location /path1&gt;
		ProxyHTMLLinks a href
		ProxyHTMLLinks area href
		ProxyHTMLLinks link href
		ProxyHTMLLinks img src longdesc usemap
		ProxyHTMLLinks object classid codebase data usemap
		ProxyHTMLLinks q cite
		ProxyHTMLLinks blockquote cite
		ProxyHTMLLinks ins cite
		ProxyHTMLLinks del cite
		ProxyHTMLLinks form action
		ProxyHTMLLinks input src usemap
		ProxyHTMLLinks head profile
		ProxyHTMLLinks base href
		ProxyHTMLLinks script src for
		
		ProxyHTMLEvents onclick ondblclick onmousedown onmouseup \
			onmouseover onmousemove onmouseout onkeypress \
			onkeydown onkeyup onfocus onblur onload \
			onunload onsubmit onreset onselect onchange
		
		ProxyPass http://host2.example.com/path2
		ProxyPassReverse http://host2.example.com/path2
		ProxyHTMLEnable On
		ProxyHTMLExtended On
		SetOutputFilter INFLATE;proxy-html;DEFLATE;
		ProxyHTMLURLMap http://host2.example.com/path2 /path1
	&lt;/Location&gt;
&lt;/VirtualHost&gt;
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-22">22</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-24">24</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-26">26</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-28">28</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-30">30</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-32">32</div><div class="crayon-num" data-line="crayon-5c44b1efd28ef059968487-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd28ef059968487-34">34</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-2"><span class="crayon-r ">&lt;</span><span class="crayon-r ">VirtualHost</span><span class="crayon-h"> </span><span class="crayon-e ">*:80</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-3"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ServerName</span><span class="crayon-h"> </span><span class="crayon-i ">host1</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-4"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;ProxyRequests</span><span class="crayon-h"> </span><span class="crayon-i ">Off</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">Location</span><span class="crayon-h"> </span><span class="crayon-e ">/path1</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-6"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">a</span><span class="crayon-h"> </span><span class="crayon-i ">href</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-7"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">area</span><span class="crayon-h"> </span><span class="crayon-i ">href</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-8"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">link</span><span class="crayon-h"> </span><span class="crayon-i ">href</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-9"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">img</span><span class="crayon-h"> </span><span class="crayon-i ">src</span><span class="crayon-h"> </span><span class="crayon-i ">longdesc</span><span class="crayon-h"> </span><span class="crayon-i ">usemap</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-10"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">object</span><span class="crayon-h"> </span><span class="crayon-i ">classid</span><span class="crayon-h"> </span><span class="crayon-i ">codebase</span><span class="crayon-h"> </span><span class="crayon-i ">data</span><span class="crayon-h"> </span><span class="crayon-i ">usemap</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-11"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">q</span><span class="crayon-h"> </span><span class="crayon-i ">cite</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-12"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">blockquote</span><span class="crayon-h"> </span><span class="crayon-i ">cite</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-13"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">ins</span><span class="crayon-h"> </span><span class="crayon-i ">cite</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-14"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">del</span><span class="crayon-h"> </span><span class="crayon-i ">cite</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-15"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">form</span><span class="crayon-h"> </span><span class="crayon-i ">action</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-16"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">input</span><span class="crayon-h"> </span><span class="crayon-i ">src</span><span class="crayon-h"> </span><span class="crayon-i ">usemap</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-17"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">head</span><span class="crayon-h"> </span><span class="crayon-i ">profile</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-18"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">base</span><span class="crayon-h"> </span><span class="crayon-i ">href</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-19"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLLinks</span><span class="crayon-h"> </span><span class="crayon-i ">script</span><span class="crayon-h"> </span><span class="crayon-i ">src</span><span class="crayon-h"> </span><span class="crayon-i ">for</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-20"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-21"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLEvents</span><span class="crayon-h"> </span><span class="crayon-i ">onclick</span><span class="crayon-h"> </span><span class="crayon-i ">ondblclick</span><span class="crayon-h"> </span><span class="crayon-i ">onmousedown</span><span class="crayon-h"> </span><span class="crayon-i ">onmouseup</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-22"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onmouseover</span><span class="crayon-h"> </span><span class="crayon-i ">onmousemove</span><span class="crayon-h"> </span><span class="crayon-i ">onmouseout</span><span class="crayon-h"> </span><span class="crayon-i ">onkeypress</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-23"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onkeydown</span><span class="crayon-h"> </span><span class="crayon-i ">onkeyup</span><span class="crayon-h"> </span><span class="crayon-i ">onfocus</span><span class="crayon-h"> </span><span class="crayon-i ">onblur</span><span class="crayon-h"> </span><span class="crayon-i ">onload</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-24"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onunload</span><span class="crayon-h"> </span><span class="crayon-i ">onsubmit</span><span class="crayon-h"> </span><span class="crayon-i ">onreset</span><span class="crayon-h"> </span><span class="crayon-i ">onselect</span><span class="crayon-h"> </span><span class="crayon-i ">onchange</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-25"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-26"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyPass</span><span class="crayon-h"> </span><span class="crayon-i ">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-i ">host2</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span><span class="crayon-o">/</span><span class="crayon-i ">path2</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-27"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyPassReverse</span><span class="crayon-h"> </span><span class="crayon-i ">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-i ">host2</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span><span class="crayon-o">/</span><span class="crayon-i ">path2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-28"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLEnable</span><span class="crayon-h"> </span><span class="crayon-i ">On</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-29"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLExtended</span><span class="crayon-h"> </span><span class="crayon-i ">On</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-30"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetOutputFilter</span><span class="crayon-h"> </span><span class="crayon-i ">INFLATE</span><span class="crayon-sy">;</span><span class="crayon-i ">proxy-html</span><span class="crayon-sy">;</span><span class="crayon-i ">DEFLATE</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-31"><span class="crayon-r">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProxyHTMLURLMap</span><span class="crayon-h"> </span><span class="crayon-i ">http</span><span class="crayon-o">:</span><span class="crayon-o">/</span><span class="crayon-o">/</span><span class="crayon-i ">host2</span><span class="crayon-sy">.</span><span class="crayon-i ">example</span><span class="crayon-sy">.</span><span class="crayon-i ">com</span><span class="crayon-o">/</span><span class="crayon-i ">path2</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i ">path1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r ">&lt;</span><span class="crayon-r ">/Location</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line" id="crayon-5c44b1efd28ef059968487-33"><span class="crayon-r ">&lt;</span><span class="crayon-r ">/VirtualHost</span><span class="crayon-r ">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd28ef059968487-34">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0081 seconds] -->
<p>&nbsp;</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="ubuntu-apache-reverse-proxy-rewrite-html-links/index.html" title="12:33 pm" rel="bookmark"><time class="entry-date" datetime="2014-11-07T12:33:52+00:00">November 7, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-59" class="post-59 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="programmatically-configure-hibernate-jpa-with-dbcp/index.html" rel="bookmark">Programmatically Configure Hibernate (JPA) with DBCP</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I recently had deadlock issues with c3p0 and statement caching. Long story short, after investigating c3p0 code, I decided to switch to <a title="Apache Commons DBCP" href="http://commons.apache.org/proper/commons-dbcp/">DBCP</a> (maybe I&#8217;ll write a post with the long story).</p>
<p>I am not a big fan of Spring (here again, maybe I&#8217;ll write a post about that). If you are like me, here is how to programmatically configure <a title="Hibernate" href="http://hibernate.org/">Hibernate</a> (JPA) to use DBCP, without Spring and without JNDI.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd2db0647054135" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Configure Hibernate (JPA) with DBCP</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

package com.opcodesolutions.demo;

import java.util.HashMap;
import java.util.Map;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.TypedQuery;

import org.apache.commons.dbcp2.BasicDataSource;
import org.hibernate.cfg.AvailableSettings;

import com.opcodesolutions.generic.jpa.entity.User;

public class HibernateJPAWithDBCP {

	public static void main(String[] args) {

		// Create and configure DBCP DataSource
		BasicDataSource dbcpDataSource = new BasicDataSource();
		dbcpDataSource.setDriverClassName("com.mysql.jdbc.Driver");
		dbcpDataSource.setUrl("jdbc:mysql://localhost:3306/database");
		dbcpDataSource.setUsername("user");
		dbcpDataSource.setPassword("************");

		// Enable statement caching (Optional)
		dbcpDataSource.setPoolPreparedStatements(true);
		dbcpDataSource.setMaxOpenPreparedStatements(50);

		// JPA properties
		Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();

		// This line will tell hibernate (JPA) to use DBCP
		properties.put(AvailableSettings.DATASOURCE, dbcpDataSource);

		// Create the EntityManagerFactory with JPA properties
		EntityManagerFactory factory =
			Persistence.createEntityManagerFactory("User", properties);

		// Test with simple query
		EntityManager entityManager = factory.createEntityManager();
		TypedQuery&lt;User&gt; query =
			entityManager.createQuery("select u from User u", User.class);
		for (User user : query.getResultList()) {
			System.out.println(user.getFullName());
		}

	}
}
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-10">10</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-12">12</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-14">14</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-16">16</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-18">18</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-20">20</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-22">22</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-24">24</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-26">26</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-28">28</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-30">30</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-32">32</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-34">34</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-36">36</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-38">38</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-40">40</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-42">42</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-44">44</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-46">46</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-48">48</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-50">50</div><div class="crayon-num" data-line="crayon-5c44b1efd2db0647054135-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd2db0647054135-52">52</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-2"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">opcodesolutions</span><span class="crayon-sy">.</span><span class="crayon-v">demo</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">HashMap</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">Map</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-6">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">persistence</span><span class="crayon-sy">.</span><span class="crayon-v">EntityManager</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">persistence</span><span class="crayon-sy">.</span><span class="crayon-v">EntityManagerFactory</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">persistence</span><span class="crayon-sy">.</span><span class="crayon-v">Persistence</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-10"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">persistence</span><span class="crayon-sy">.</span><span class="crayon-v">TypedQuery</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-12"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">apache</span><span class="crayon-sy">.</span><span class="crayon-v">commons</span><span class="crayon-sy">.</span><span class="crayon-v">dbcp2</span><span class="crayon-sy">.</span><span class="crayon-v">BasicDataSource</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-13"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">hibernate</span><span class="crayon-sy">.</span><span class="crayon-v">cfg</span><span class="crayon-sy">.</span><span class="crayon-v">AvailableSettings</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-14">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-15"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">opcodesolutions</span><span class="crayon-sy">.</span><span class="crayon-v">generic</span><span class="crayon-sy">.</span><span class="crayon-v">jpa</span><span class="crayon-sy">.</span><span class="crayon-v">entity</span><span class="crayon-sy">.</span><span class="crayon-v">User</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-16">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-17"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">HibernateJPAWithDBCP</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-18">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-20">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Create and configure DBCP DataSource</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">BasicDataSource </span><span class="crayon-v">dbcpDataSource</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">BasicDataSource</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setDriverClassName</span><span class="crayon-sy">(</span><span class="crayon-s">"com.mysql.jdbc.Driver"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setUrl</span><span class="crayon-sy">(</span><span class="crayon-s">"jdbc:mysql://localhost:3306/database"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setUsername</span><span class="crayon-sy">(</span><span class="crayon-s">"user"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setPassword</span><span class="crayon-sy">(</span><span class="crayon-s">"************"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Enable statement caching (Optional)</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setPoolPreparedStatements</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">.</span><span class="crayon-e">setMaxOpenPreparedStatements</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// JPA properties</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Map</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Object</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">properties</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">HashMap</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-34">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// This line will tell hibernate (JPA) to use DBCP</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">properties</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-v">AvailableSettings</span><span class="crayon-sy">.</span><span class="crayon-v">DATASOURCE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dbcpDataSource</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Create the EntityManagerFactory with JPA properties</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EntityManagerFactory </span><span class="crayon-v">factory</span><span class="crayon-h"> </span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Persistence</span><span class="crayon-sy">.</span><span class="crayon-e">createEntityManagerFactory</span><span class="crayon-sy">(</span><span class="crayon-s">"User"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">properties</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Test with simple query</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EntityManager </span><span class="crayon-v">entityManager</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">factory</span><span class="crayon-sy">.</span><span class="crayon-e">createEntityManager</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TypedQuery</span><span class="crayon-e ">&lt;User&gt;</span><span class="crayon-h"> </span><span class="crayon-v">query</span><span class="crayon-h"> </span><span class="crayon-o">=</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">entityManager</span><span class="crayon-sy">.</span><span class="crayon-e">createQuery</span><span class="crayon-sy">(</span><span class="crayon-s">"select u from User u"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">User</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">User </span><span class="crayon-v">user</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">query</span><span class="crayon-sy">.</span><span class="crayon-e">getResultList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">out</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-e">getFullName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5c44b1efd2db0647054135-51"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd2db0647054135-52">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0049 seconds] -->
<p>With DBCP, all my deadlock issues disappeared. Thank you <a title="The Apache Software Foundation" href="http://www.apache.org/">ASF</a>.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="programmatically-configure-hibernate-jpa-with-dbcp/index.html" title="4:49 pm" rel="bookmark"><time class="entry-date" datetime="2014-11-04T16:49:23+00:00">November 4, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-12" class="post-12 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="solve-java-lang-outofmemoryerror-java-heap-space/index.html" rel="bookmark">How to fix java.lang.OutOfMemoryError: Java heap space</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>If you get an <strong>OutOfMemoryError</strong> with the message &#8220;<strong>Java heap space</strong>&#8221; (not to be confused with message &#8220;<strong><a title="java.lang.OutOfMemoryError: PermGen space" href="java-lang-outofmemoryerror-permgen-space/index.html">PermGen space</a></strong>&#8220;), it simply means the JVM ran out of memory. When it occurs, you basically have 2 options:</p>
<h2>Solution 1. Allow the JVM to use more memory</h2>
<p>With the <strong>-Xmx</strong> JVM argument, you can set the heap size. For instance, you can allow the JVM to use 2 GB (2048 MB) of memory with the following command:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd3204102087128" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Configuring java heap size</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ java -Xmx2048m ...
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd3204102087128-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd3204102087128-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd3204102087128-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd3204102087128-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd3204102087128-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">Xmx2048m</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5c44b1efd3204102087128-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h2>Solution 2. Improve or fix the application to reduce memory usage</h2>
<p>In many cases, like in the case of a memory leak, that second option is the only good solution. A memory leak happens when the application creates more and more objects and never releases them. The garbage collector cannot collect those objects and the application will eventually run out of memory. At this point, the JVM will throw an OOM (OutOfMemoryError).</p>
<p>A memory leak can be very latent. For instance, the application might behave flawlessly during development and QA. However, it suddenly throws a OOM after several days in production at customer site. To solve that issue, you first need to find the root cause of it. The root cause can be very hard to find in development if the problem cannot be reproduced. Follow those steps to find the root cause of the OOM:</p>
<h3>Step 1. Generate a heap dump on OutOfMemoryError</h3>
<p>Start the application with the VM argument <strong>-XX:+HeapDumpOnOutOfMemoryError</strong>. This will tell the JVM to produce a heap dump when a OOM occurs:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd320b121758959" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Trigger heap dump on OOM</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ java -XX:+HeapDumpOnOutOfMemoryError ...
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd320b121758959-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320b121758959-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd320b121758959-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd320b121758959-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320b121758959-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">XX</span><span class="crayon-o">:</span><span class="crayon-o">+</span><span class="crayon-i">HeapDumpOnOutOfMemoryError</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5c44b1efd320b121758959-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h3>Step 2. Reproduce the problem</h3>
<p>Well, if you cannot reproduce the problem in dev, you may have to use the production environment. When you reproduce the problem and the application throws an OOM, it will generate a heap dump file.</p>
<h3>Step 3. Investigate the issue using the heap dump file</h3>
<p>Use <a title="VisualVM" href="http://visualvm.java.net/">VisualVM</a> to read the heap dump file and diagnose the issue. VisualVM is a program located in <strong>JDK_HOME/bin/jvisualvm</strong>. The heap dump file has all information about the memory usage of the application. It allows you to navigate the heap and see which objects use the most memory and what references prevent the garbage collector from reclaiming the memory. Here is a screenshot of <a title="VisualVM" href="http://visualvm.java.net/">VisualVM</a> with a heap dump loaded:</p>
<p><a href="wp-content/uploads/2014/11/2014-11-04-143434_714x503_scrot.png"><img class="alignnone wp-image-37 size-full" src="wp-content/uploads/2014/11/2014-11-04-143434_714x503_scrot.png" alt="Heap Dump in VisualVM" width="714" height="503" /></a></p>
<p>This will give you very strong hints and you will (hopefully) be able to find the root cause of the problem. The problem could be a cache that grows indefinitely, a list that keeps collecting business-specific data in memory, a huge request that tries to load almost all data from database in memory, etc.</p>
<p>Once you know the root cause of the problem, you can elaborate solutions to fix it. In case of a cache that grows indefinitely, a good solution could be to set a reasonable limit to that cache. In case of a query that tries to load almost all data from database in memory, you may have to change the way you manipulate data; you could even have to change the behavior of some functionalities of the application.</p>
<h2>Manually triggering heap dump</h2>
<p>If you do not want to wait for an OOM or if you just want to see what is in memory now, you can manually generate heap dump. Here 2 options to manually trigger a heap dump.</p>
<h3>Option 1. Use <a title="VisualVM" href="http://visualvm.java.net/">VisualVM</a></h3>
<p>Open VisualVM (JDK_HOME/bin/jvisualvm), right-click on the process on the left pane and select Heap Dump. That&#8217;s it.</p>
<h3>Option 2. Use command line tools</h3>
<p>If you do not have a graphical environment and can&#8217;t use vnc (<a title="VisualVM" href="http://visualvm.java.net/">VisualVM</a> needs a graphical environment), use <a title="Java Process Status" href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jps.html">jps</a> and <a title="Java Memory Map" href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jmap.html">jmap</a> to generate the heap dump file. Those programs are also located in <strong>JDK_HOME/bin/</strong>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd320f763029219" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Use jps and jmap to trigger heap dump</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ jps
6162 Jps
4729 org.eclipse.equinox.launcher_1.3.0.v20130327-1440.jar
6057 Bootstrap

$ jmap -dump:live,format=b,file=heap.bin 6057
Dumping heap to /home/user/heap.bin ...
Heap dump file created
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd320f763029219-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320f763029219-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd320f763029219-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320f763029219-4">4</div><div class="crayon-num" data-line="crayon-5c44b1efd320f763029219-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320f763029219-6">6</div><div class="crayon-num" data-line="crayon-5c44b1efd320f763029219-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320f763029219-8">8</div><div class="crayon-num" data-line="crayon-5c44b1efd320f763029219-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd320f763029219-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd320f763029219-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320f763029219-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-i">jps</span></div><div class="crayon-line" id="crayon-5c44b1efd320f763029219-3"><span class="crayon-cn">6162</span><span class="crayon-h"> </span><span class="crayon-i">Jps</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320f763029219-4"><span class="crayon-cn">4729</span><span class="crayon-h"> </span><span class="crayon-v">org</span><span class="crayon-e">.eclipse</span><span class="crayon-e">.equinox</span><span class="crayon-e">.launcher_1</span><span class="crayon-sy">.</span><span class="crayon-cn">3.0.v20130327</span><span class="crayon-o">-</span><span class="crayon-cn">1440.jar</span></div><div class="crayon-line" id="crayon-5c44b1efd320f763029219-5"><span class="crayon-cn">6057</span><span class="crayon-h"> </span><span class="crayon-i">Bootstrap</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320f763029219-6">&nbsp;</div><div class="crayon-line" id="crayon-5c44b1efd320f763029219-7"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">jmap</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">dump</span><span class="crayon-o">:</span><span class="crayon-v">live</span><span class="crayon-sy">,</span><span class="crayon-v">format</span><span class="crayon-o">=</span><span class="crayon-v">b</span><span class="crayon-sy">,</span><span class="crayon-r">file</span><span class="crayon-o">=</span><span class="crayon-v">heap</span><span class="crayon-e">.bin</span><span class="crayon-h"> </span><span class="crayon-cn">6057</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320f763029219-8"><span class="crayon-e">Dumping </span><span class="crayon-e">heap </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">home</span><span class="crayon-o">/</span><span class="crayon-v">user</span><span class="crayon-o">/</span><span class="crayon-v">heap</span><span class="crayon-e">.bin</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5c44b1efd320f763029219-9"><span class="crayon-e">Heap </span><span class="crayon-e">dump </span><span class="crayon-r">file</span><span class="crayon-h"> </span><span class="crayon-i">created</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd320f763029219-10">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Finally copy the heap dump file (heap.bin) to your workstation and use <a title="VisualVM" href="http://visualvm.java.net/">VisualVM</a> to read the heap dump: <strong>File -&gt; Load&#8230;</strong></p>
<p>Alternatively, you can also use <a title="Java Heap Analysis Tool" href="http://docs.oracle.com/javase/7/docs/technotes/tools/share/jhat.html">jhat</a> to read heap dump files.</p>
<h2>Solution 3 (bonus). Call me</h2>
<p>You can also contact my <a title="Software Development" href="https://opcodesolutions.com/">application development company</a> and I can personally help you with those kind of issues 🙂</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="solve-java-lang-outofmemoryerror-java-heap-space/index.html" title="10:07 am" rel="bookmark"><time class="entry-date" datetime="2014-11-04T10:07:04+00:00">November 4, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-7" class="post-7 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="java-lang-outofmemoryerror-permgen-space/index.html" rel="bookmark">How to fix java.lang.OutOfMemoryError: PermGen space</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>When you get an OutOfMemoryError with the message &#8220;<strong>PermGen space</strong>&#8221; (not to be confused with message &#8220;<a title="java.lang.OutOfMemoryError: Java heap space" href="solve-java-lang-outofmemoryerror-java-heap-space/index.html">Java heap space</a>&#8220;), this means the memory used for <strong>class definition</strong> is exhausted. Fortunately, most of the time, this is easy to fix.</p>
<h2>Solution 1 (your best bet). Increase the size of <strong>PermGen</strong> space</h2>
<p>If you have a Java process that uses a lot of classes (lots of jars) or if you have many applications deployed to your application container (Tomcat), you can allocate more memory to that &#8220;PermGen space&#8221; using the <b>-XX:MaxPermSize</b> VM argument. For instance, to allocate 512 MB of RAM to PermGen space, use:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd36a6558115467" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Configuring PermGen space</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

java -XX:MaxPermSize=512M ...
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd36a6558115467-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd36a6558115467-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd36a6558115467-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd36a6558115467-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd36a6558115467-2"><span class="crayon-v">java</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">XX</span><span class="crayon-o">:</span><span class="crayon-v">MaxPermSize</span><span class="crayon-o">=</span><span class="crayon-cn">512M</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5c44b1efd36a6558115467-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h2>Solution 2. Restart your application container</h2>
<p>You can get this error if you redeploy an application (webapp) several time without restarting your application container (like Tomcat). Most application containers support hot-redeployment, but class-loading is complex and sometimes old class definitions remain in memory. In that case, your best option is to get used to <span style="text-decoration: underline;">always restart your application container (Tomcat) after you deploy an application to it</span>. This is easy and it fixes many problems.</p>
<h2>Solution 3. Fix your class-loader leak</h2>
<p>If none of the above works, you are in trouble 🙁 Seriously, unless you hacked the class-loading of the JVM or application container, you should not have that problem. Or maybe it is a bug in a library you are using or in your application container. You can try to upgrade to latest versions. If you hacked the class-loaders yourself, you may want to reconsider it. Why did you do that? Unless you are developing a JVM or an application container, you should not have to do that.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="java-lang-outofmemoryerror-permgen-space/index.html" title="8:48 am" rel="bookmark"><time class="entry-date" datetime="2014-05-30T08:48:05+00:00">May 30, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-8" class="post-8 post type-post status-publish format-standard hentry category-development category-news">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="new-website-for-my-software-development-company/index.html" rel="bookmark">New website for my software development company</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>My <a title="Software Development" href="https://opcodesolutions.com/">application development company</a> just got a new website. It shows more relevant information and has a lean design powered by <a href="http://getbootstrap.com/">Bootstrap</a>. It is now hosted on <a href="http://aws.amazon.com/ec2/">Amazon EC2</a>. If you need a software for your business, call us. We will discuss your project and we&#8217;ll give you a free quote, see our <a title="OpCode Solutions Pricing" href="https://opcodesolutions.com/en/pricing/">pricing</a> and <a title="OpCode Solutions Managed Hosting" href="https://opcodesolutions.com/en/hosting/">application hosting packages</a>. All the applications we develop <a title="OpCode Solutions Demo" href="../en/demo/index.html">run on desktop, tablet and smartphone out of the box</a>.</p>
<p>Alright, enough bragging, back to work now!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a>, <a href="category/news/index.html" rel="category tag">News</a> on <a href="new-website-for-my-software-development-company/index.html" title="11:25 am" rel="bookmark"><time class="entry-date" datetime="2014-05-29T11:25:31+00:00">May 29, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-9" class="post-9 post type-post status-publish format-standard hentry category-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="visualvm-slow-with-heap-dump-files/index.html" rel="bookmark">VisualVM slow with heap dump files</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>One great feature of <a title="VisualVM" href="https://visualvm.dev.java.net/">VisualVM</a> is that it can read heap dump files. Heap dumps are useful to diagnose memory leaks. See this post for more details about <a title="How to fix java.lang.OutOfMemoryError: Java heap space" href="solve-java-lang-outofmemoryerror-java-heap-space/index.html">memory leaks and how to solve them</a>.</p>
<h2>Why VisualVM is slow with heap dump</h2>
<p>Another great feature of VisualVM is that you can read a huge heap dump file and VisualVm will consume a minimal amount of memory to do so. For instance, you will be able to read a 8 Gigabytes heap dump file with VisualVM running on a development workstation having only 2 Gigabytes of RAM. In order to achieve that, VisualVM will parse the heap dump file and will create a work file on disk in the default system temp folder (/tmp by default on Linux). In theory that&#8217;s great, but in practice, VisualVM becomes painfully slow because it constantly have to do disk I/O&#8217;s to process the information.</p>
<p>This behavior is even more frustrating if you happen to have a server with 12 Gigabytes of RAM available for you. A simple solution for that is to create a ramdisk and tell VisualVM to use that ramdisk as the tmp folder.</p>
<h2>The solution: use a RAMDisk</h2>
<p>First, create the RAMDisk (tmpfs). Here I am on a linux development server and I create a tmp folder in my home. Then I create (mount) the ramdisk in the tmp folder I just created:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd3ac0159970813" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Create a ramdisk</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ mkdir /tmp/ramdisk
$ sudo mount -t tmpfs none /tmp/ramdisk
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd3ac0159970813-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd3ac0159970813-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd3ac0159970813-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd3ac0159970813-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd3ac0159970813-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd3ac0159970813-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-r">mkdir</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">tmp</span><span class="crayon-o">/</span><span class="crayon-i">ramdisk</span></div><div class="crayon-line" id="crayon-5c44b1efd3ac0159970813-3"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-v">mount</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">tmpfs </span><span class="crayon-v">none</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">tmp</span><span class="crayon-o">/</span><span class="crayon-i">ramdisk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd3ac0159970813-4">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Then I launch VisualVM and I modify the java.io.tmpdir VM arg that tells VisualVM where the system tmp folder is.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c44b1efd3ac6105845808" class="crayon-syntax crayon-theme-eclipse crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">Configure tmpdir when starting VisualVM</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">

$ jvisualvm -J-Djava.io.tmpdir=/tmp/ramdisk
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c44b1efd3ac6105845808-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c44b1efd3ac6105845808-2">2</div><div class="crayon-num" data-line="crayon-5c44b1efd3ac6105845808-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c44b1efd3ac6105845808-1">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c44b1efd3ac6105845808-2"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">jvisualvm</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">J</span><span class="crayon-o">-</span><span class="crayon-v">Djava</span><span class="crayon-e">.io</span><span class="crayon-e">.tmpdir</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">tmp</span><span class="crayon-o">/</span><span class="crayon-i">ramdisk</span></div><div class="crayon-line" id="crayon-5c44b1efd3ac6105845808-3">&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Now VisualVM is much much faster and I can investigate and find the root cause of that memory leak much faster.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/development/index.html" rel="category tag">Development</a> on <a href="visualvm-slow-with-heap-dump-files/index.html" title="10:52 pm" rel="bookmark"><time class="entry-date" datetime="2010-06-12T22:52:37+00:00">June 12, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-13" class="post-13 post type-post status-publish format-standard hentry category-news">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="oracle-to-acquire-sun/index.html" rel="bookmark">Oracle to Acquire Sun</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>After IBM, now is the turn to Oracle. <a href="http://www.reuters.com/article/newsOne/idUSN2038153320090420" title="Oracle acquires Sun">Oracle buys Sun</a> and pays $7.4 billion for that acquisition ($9.50 per share), $5.6 billion if we take into account Sun&apos;s cash. Is that a good thing or a bad thing for the Java community? Probably a good thing as it will allow Sun&apos;s project to benefit from Oracle&apos;s technologies. But only future will tell.</p>
<p>With Java, GlassFish, MySQL, OpenOffice, Solaris and its cloud computing services, that certainly widens Oracle&apos;s possibilities. Hopefully Oracle will continue supporting adequately those famous open source projects. I am not concerned about Java, but maybe more about MySQL. While MySQL could certainly benefit from Oracle&apos;s expertise in database field, Oracle could also put MySQL behind in order to promote its more profitable flagship product: Oracle&apos;s RDBMS. The same is true for GlassFish and WebLogic. In any case, it is a very quick way for Oracle to have an open source offering for their products.</p>
<p>If we only consider Java, I have to admit that I rather see Oracle acquiring Sun than IBM doing it. The reason is simple, IBM already offers a Java runtime and they are competitors in that field. An acquisition by IBM would reduce the competition in that areas, which is always a bad thing for customers. In my opinion, Sun&apos;s JVM largely beats IBM&apos;s one, but it would still be a bad thing to see one of them die to the benefit of the other.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="category/news/index.html" rel="category tag">News</a> on <a href="oracle-to-acquire-sun/index.html" title="1:38 pm" rel="bookmark"><time class="entry-date" datetime="2009-04-20T13:38:55+00:00">April 20, 2009</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="author/jdemers/index.html" title="View all posts by Jonathan Demers" rel="author">Jonathan Demers</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
			
						<nav id="nav-below" class="navigation" role="navigation">
				<h3 class="assistive-text">Post navigation</h3>
				<div class="nav-previous"><a href="page/2/index.html" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				<div class="nav-next"></div>
			</nav><!-- .navigation -->
			
		
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
					<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">More Articles</h3>		<ul>
											<li>
					<a href="how-to-migrate-3-mysql-databases-to-amazon-rds-in-5-minutes/index.html">How to Migrate 3 MySQL Databases to Amazon RDS in 5 Minutes</a>
									</li>
											<li>
					<a href="imageio-read-causes-outofmemoryerror/index.html">ImageIO.read() causes OutOfMemoryError</a>
									</li>
											<li>
					<a href="https-wildcard-subdomain-dns-apache-tomcat-config/index.html">HTTPS Wildcard Subdomain: DNS + Apache + Tomcat Config</a>
									</li>
											<li>
					<a href="ubuntu-apache-reverse-proxy-rewrite-html-links/index.html">Ubuntu Apache Reverse Proxy Rewrite HTML Links</a>
									</li>
											<li>
					<a href="programmatically-configure-hibernate-jpa-with-dbcp/index.html">Programmatically Configure Hibernate (JPA) with DBCP</a>
									</li>
					</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-2"><a href="category/development/index.html" >Development</a>
</li>
	<li class="cat-item cat-item-50"><a href="category/how-to/index.html" >How To</a>
</li>
	<li class="cat-item cat-item-12"><a href="category/news/index.html" >News</a>
</li>
		</ul>
</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
									<a href="https://wordpress.org/" class="imprint" title="Semantic Personal Publishing Platform">
				Proudly powered by WordPress			</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='wp-content/themes/twentytwelve/js/navigation.js%3Fver=20140711'></script>
<script type='text/javascript' src='wp-includes/js/wp-embed.min.js%3Fver=5.0.3'></script>
</body>
</html>
